
var channel = new MessageChannel();
var head = {}, tail = head;
channel.port1.onmessage = function () {
    var task = head.next.task;
    head = head.next;
    task();
};
enqueue = function (task) {
    tail.next = {task: task};
    channel.port2.postMessage();
};

enqueue(function () {
    console.log(1);
    enqueue(function () {
        console.log(4);
    });
});
enqueue(function () {
    console.log(2);
    enqueue(function () {
        console.log(5);
    });
});
enqueue(function () {
    console.log(3);
});

